<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MK60EC1 Longcoding Decoder</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { width: 80%; margin: auto; }
        textarea { width: 100%; height: 50px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        .bit-box { display: inline-block; width: 20px; text-align: center; font-weight: bold; }
        .bit-on { color: green; }
        .bit-off { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h2>MK60EC1 Longcoding Decoder</h2>
        <textarea id="longcoding" placeholder="Insira o Longcoding"></textarea>
        <button onclick="decodeLongcoding()">Decodificar</button>
        <table>
            <thead>
                <tr>
                    <th>Byte</th>
                    <th>Valor</th>
                    <th>Bits</th>
                    <th>Descrição</th>
                </tr>
            </thead>
            <tbody id="decodedTable"></tbody>
        </table>
    </div>

    <script>
        function byteToBits(byte) {
            let binary = parseInt(byte, 16).toString(2).padStart(8, '0');
            return binary.split('').map((bit, index) => 
                `<span class="bit-box ${bit === '1' ? 'bit-on' : 'bit-off'}">${bit}</span>`).join('');
        }

        const lookupTable = {
            0: { "11": "Modelo A3/Golf/Leon/Octavia", "14": "Modelo GTI/R/S3/Cupra" },
            1: { "3B": "VIN: 1", "3C": "VIN: 2" },
            2: { "20": "Freios dianteiros 280mm", "40": "Freios dianteiros 288mm" },
            3: { "08": "Motor F", "0A": "Motor H" },
            4: function(byte) {
                let val = parseInt(byte, 16);
                let config = (val & 0x10) ? "Sensor G608 ativo" : "Sem Sensor G608";
                return config;
            },
            6: function(byte) {
                let val = parseInt(byte, 16);
                let transmission = val & 0x0F;
                let esc = (val & 0x80) ? "ESC pode ser desligado" : "ESC fixo";
                return `Transmissão: ${transmission}, ${esc}`;
            },
            15: function(byte) {
                let val = parseInt(byte, 16);
                let torque = val & 0x07;
                let offroad = (val & 0x08) ? "Botão Off-Road presente" : "Sem botão Off-Road";
                return `Torque: ${torque}, ${offroad}`;
            }
        };

        function decodeLongcoding() {
            const input = document.getElementById('longcoding').value.trim().replace(/\s+/g, "");
            const bytes = input.match(/.{1,2}/g) || [];
            let output = '';
            bytes.forEach((byte, index) => {
                let description = lookupTable[index] 
                    ? (typeof lookupTable[index] === 'function' ? lookupTable[index](byte) : lookupTable[index][byte] || "Desconhecido") 
                    : "Desconhecido";
                let bits = byteToBits(byte); 
                output += `<tr><td>${index}</td><td>${byte}</td><td>${bits}</td><td>${description}</td></tr>`;
            });
            document.getElementById('decodedTable').innerHTML = output;
        }
    </script>
</body>
</html>
